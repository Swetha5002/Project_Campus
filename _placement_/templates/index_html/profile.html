{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VCET - ECE Department</title>
    <link rel="stylesheet" href="{% static 'css/profile.css' %}">
    <link rel="stylesheet" href="{% static 'css/components.css' %}">
    {% include 'components/links.html' %}
</head>

<body>

    {% include 'components/header.html' %}

    <!-- Main Content -->
    <div class="vcet-bg">
        <div class="container">
            <!-- Enhanced Profile Section -->
            <div class="profile-container">
                <button class="profile-edit-btn" title="Edit Profile">
                    <i class="bi bi-pencil"></i>
                </button>

                <div class="profile-content">
                    <div class="profile-picture">
                        {% if user.profile_image %}
                        <img src="{{ user.profile_image.url }}" alt="Profile Picture" class="img-fluid">
                        {% else %}
                        <img src="{% static 'images/profile_no.png' %}" alt="Profile" class="img-fluid">

                        {% endif %}
                    </div>
                    <div class="profile-details">
                        <h2>
                            <a href="{% url 'class_details' user.batch_year %}" class="text-decoration-none">
                                {{ request.user.username }}
                            </a>
                            <span class="badge bg-success">
                                <a href="{% url 'class_details' user.batch_year %}"
                                    class="text-white text-decoration-none">
                                    {{ user.batch_year }}
                                </a>
                            </span>
                        </h2>

                        <div class="profile-info">
                            <div class="profile-info-item">
                                <i class="bi bi-person-badge"></i>
                                <strong>University No:</strong> {{ request.user.university_number }}
                            </div>
                            <div class="profile-info-item">
                                <i class="bi bi-building"></i>
                                <strong>Batch:</strong>
                                <a href="{% url 'class_details' user.batch_year %}" class="text-decoration-none">
                                    {{ user.batch_year }}
                                </a>
                            </div>
                            <div class="profile-info-item">
                                <i class="bi bi-calendar-event"></i>
                                <strong>DOB:</strong> {{ user.date_of_birth }}
                            </div>
                            <div class="profile-info-item">
                                <i class="bi bi-envelope"></i>
                                <strong>Email:</strong> {{ user.email }}
                            </div>
                            <div class="profile-info-item">
                                <i class="bi bi-telephone"></i>
                                <strong>Phone:</strong> {{ user.phone_number }}
                            </div>
                            <div class="profile-info-item">
                                <i class="bi bi-graph-up"></i>
                                <strong>CGPA:</strong> {{ user.cgpa }}
                            </div>
                        </div>

                        <!-- Coding Profiles Section -->
                        <div class="coding-profiles">
                            <h4><i class="bi bi-code-square me-2"></i>Coding Profiles</h4>
                            <div class="coding-platforms">
                                {% for platform in user.code_platforms %}
                                <div class="platform-card">
                                    <div class="platform-name">{{ platform.name }}</div>
                                    <a href="{{ platform.link }}" class="platform-link" target="_blank">
                                        View Profile <i class="bi bi-box-arrow-up-right"></i>
                                    </a>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Test History Section -->
            <div class="profileData-container">
                <div class="table-container">
                    <caption><i class="bi bi-clock-history me-2"></i>Test History</caption>
                    <table class="table table-hover">

                        <thead>
                            <tr>
                                <th>Sl.No</th>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Test Code</th>
                                <th>Test Name</th>
                                <th>Score</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for result in user.results.all %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>{{ result.date_of_exam }}</td>
                                <td>{{ result.time }}</td>
                                <td>{{ result.test_code }}</td>
                                <td>{{ result.test_title }}</td>
                                <td>{{ result.percentage }}%</td>
                                <td class="status-{{ result.status|lower }}">{{ result.get_status_display }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="7" class="text-center">No test history available.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    {% include 'components/footer.html' %}

</body>
<script>
    const edit_btn = document.querySelector('.profile-edit-btn');
        edit_btn.addEventListener('click', function() {
            window.location.href = "{% url 'edit_profile' %}";
        });
</script>

</html>